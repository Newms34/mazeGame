"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},app=angular.module("mazeGame",["ngTouch"]).controller("log-con",["$scope","$http","$q","$timeout","$window","userFact",function(e,n,t,r,o,a){e.hazLogd=!1,e.newUsr=function(){if(e.regForm.pwd.$viewValue!=e.regForm.pwdTwo.$viewValue)sandalchest.alert("Your passwords don&rsquo;t match!",function(){});else{var t={user:e.regForm.username.$viewValue,password:e.regForm.pwd.$viewValue};n.post("/user/new",t).then(function(n){"saved!"==n.data&&e.login(!0)})}},e.passMatch=!0,e.passStr=0,e.isNew=!1,e.checkPwdStr=function(){e.regForm.pwd.$viewValue&&(e.passStr=a.checkPwdStr(e.regForm.pwd.$viewValue)),console.log("pwd strength",e.passStr)},e.checkPwds=function(){e.passMatch=a.checkPwdMatch(e.regForm.pwd.$viewValue,e.regForm.pwdTwo.$viewValue)},e.dupName=!1,e.nameCheck=function(){var n=e.regForm.username.$viewValue;console.log("userFact",a.checkName,"name",n),a.checkName(n).then(function(n){e.dupName=n})},e.login=function(n){n?a.login({name:e.regForm.username.$viewValue,pwd:e.regForm.pwd.$viewValue}).then(function(n){n?(e.hazLogd=!0,e.getNews()):sandalchest.alert("Either your username or password is not correct!")}):a.login({name:e.logForm.username.$viewValue,pwd:e.logForm.pwd.$viewValue}).then(function(n){n?(e.hazLogd=!0,e.getNews()):sandalchest.alert("Either your username or password is not correct!")})},e.play=function(){o.location.href="./"},e.passInf=function(){sandalchest.alert('<h3>Password Strength</h3><hr/>Here are a few things to include for a stronger password:<ul><li>A lowercase letter</li><li>An uppercase letter</li><li>A number</li><li>A non alpha-numeric symbol (something like "@" or "$")</li></ul>Longer passwords are also generally better!')},e.upd=[],e.getNews=function(){n.get("/other/news").then(function(n){e.upd=n.data.split(/[\n\r]/)})},e.getNews(),e.parseInt=parseInt}]),socket=io();app.controller("maze-con",["$scope","$http","$q","$interval","$timeout","$window","mazeFac","combatFac","UIFac","userFact","econFac",function(e,n,t,r,o,a,i,l,s,c,m){e.width=6,e.height=6,e.path=[],e.backtraceNum,e.currCell,e.bombsLeft=5,e.cellsDone=0,e.moveReady=!1,e.cells=[],e.cellNames=[],e.invActive=!1,e.setActive=!1,e.intTarg,e.lvl=1,e.playerItems=[],e.questList=[],e.doneQuest=[],e.maxHp=0,e.currHp=0,e.maxEn=0,e.currEn=0,e.isStunned=!1,e.inCombat=!1,e.merchy={},e.name="",e.currSkillNum=0,e.uName="",(e.checkPhone=function(){var e=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(e=!0),e?a.location.href="./mobile":c.checkLogin().then(function(e){console.log("RESPONSE FROM CHECK LOGIN:",e),e||(a.location.href="./login")})})(),e.fillCells=function(){console.log("cells:",e.cells);for(var n=[],r=[],o=[],a=0;a<e.cells.length;a++)"mons"==e.cells[a].has?n.push(i.popCell(e.lvl,e.cells[a].id)):"npcs"==e.cells[a].has&&(console.log(e.cells[a].id,"has an npc."),r.push(m.getNpc(e.cells[a].id)));t.all(n).then(function(n){n.forEach(function(n){e.cells[e.cellNames.indexOf(n.cell)].has=n.mons}),t.all(r).then(function(n){n.forEach(function(n){e.cells[e.cellNames.indexOf(n.id)].has=n.data,n.data.isMerch&&1==n.data.isMerch&&o.push(m.merchInv(n.data.inv,n.id))}),t.all(o).then(function(n){var r=[];n.forEach(function(n){console.log("INV",n),e.cells[e.cellNames.indexOf(n.id)].has.inv=n.inv,r.push(m.getQuests(e.name,n.id,e.lvl))}),t.all(r).then(function(n){console.log(n),n.forEach(function(n){e.cells[e.cellNames.indexOf(n.id)].has.quest=n.q,console.log("NPC HAS QUEST:",n.q,n.id)})})})})})},e.doMaze=function(n,t){var r=i.makeMaze(n,t);e.cells=r.cells,e.path=r.path,e.cellNames=r.names,e.bombsLeft=5,e.moveReady=!0,e.playerCell="0-0",e.fillCells()},e.getUsrData=function(){n.get("/user/currUsrData").then(function(n){console.log("CURR USR DATA","undefined"==typeof n?"undefined":_typeof(n),n),e.playerItems=n.data.equip,e.lvl=n.data.lvl,e.questList=n.data.inProg,e.doneQuest=n.data.questDone,e.maxHp=n.data.maxHp,e.currHp=n.data.currHp,e.maxEn=n.data.maxEn,e.currEn=n.data.currEn,e.isStunned=n.data.isStunned,e.name=n.data.name,m.merchInv(e.playerItems.inv).then(function(t){for(var r=0;r<t.length;r++)console.log("REPLACING",e.playerItems.inv[r].item,"WITH",t[r]),e.playerItems.inv[r].item=t[r];n.data.currentLevel&&n.data.currentLevel.loc&&null!=n.data.currentLevel.loc&&""!=n.data.currentLevel.loc?(e.cells=n.data.currentLevel.data,e.cellNames=n.data.currentLevel.names,e.playerCell=n.data.currentLevel.loc,e.moveReady=!0):(console.log("User does not already have level data saved!"),e.doMaze(e.width,e.height))})})},e.getUsrData(),e.getInvName=function(e){var n="";return e.item?(e.item.name?n=e.item.name:e.item.length&&e.item instanceof Array&&e.item.length>2&&(n=e.item[0].pre+" "+e.item[1].name+" "+e.item[2].post),n):"ERROR!"},e.dmgType=l.getDmgType,e.compareCell=function(n){return n==e.playerCell},e.bodyBoxes=[{name:"head",x:81,y:1,imgUrl:"./img/UI/head.jpg"},{name:"chest",x:80,y:115,imgUrl:"./img/UI/chest.jpg"},{name:"legs",x:82,y:361,imgUrl:"./img/UI/legs.jpg"},{name:"hands",x:1,y:285,imgUrl:"./img/UI/hands.jpg"},{name:"feet",x:79,y:510,imgUrl:"./img/UI/feet.jpg"},{name:"weap",x:158,y:284,imgUrl:"./img/UI/weap.jpg"}],e.Skills=[],e.Bestiary=[],e.Quests=[],e.currUINum=0,e.UIPans=["Inventory","Skills","Bestiary","Quests","Menu"],e.currUIObjs=[],e.currUIBg="../img/UI/inv.jpg",e.currUIPan=e.UIPans[e.currUINum],e.chInv=function(n){!n&&e.currUINum>0?e.currUINum--:n?1==n&&e.currUINum<e.UIPans.length-1?e.currUINum++:1==n&&(e.currUINum=0):e.currUINum=e.UIPans.length-1,e.currUIPan=e.UIPans[e.currUINum],"Menu"!==e.currUIPan&&"Inventory"!==e.currUIPan?s.getUIObj(e.currUIPan,e[e.currUIPan]).then(function(n){e.currUIObjs=n.data,"Bestiary"==e.currUIPan&&e.currUIObjs.forEach(function(e){e.imgUrl="/img"+e.imgUrl}),console.log("UI OBJS:",e.currUIObjs)}):"Inventory"==e.currUIPan&&s.doPlayerInv(e.playerItems,e.bodyBoxes).then(function(n){e.bodyBoxes=n,e.currUIObjs=e.playerItems.inv}),e.currUIBg=s.getUIBg(e.currUIPan)},e.chInv(1),e.bombOn=!1,e.roomRot=0,e.playerFacing=0,window.onkeydown=function(n){if(e.moveReady&&73!==n.which){var t=e.cells[e.cellNames.indexOf(e.playerCell)],r=e.playerCell.split("-")[0],o=e.playerCell.split("-")[1],a="north";a=e.playerFacing<45||e.playerFacing>315?"north":e.playerFacing>=45&&e.playerFacing<135?"west":e.playerFacing>=225&&e.playerFacing<315?"east":"south";var i=!1,s=!1;if(87==n.which||38==n.which&&!e.moving){if(i=!0,s=!1,t[a]?e.bombOn&&(s=!0,e.bomb(a),e.bombsLeft--):s=!0,s)switch(a){case"north":o--;break;case"south":o++;break;case"east":r++;break;default:r--}console.log("Attempting to move",a)}else if(83==n.which||40==n.which&&!e.moving){i=!0;var c;switch(a){case"north":c="south";break;case"south":c="north";break;case"east":c="west";break;default:c="east"}if(s=!1,t[c]?e.bombOn&&(s=!0,e.bomb(c),e.bombsLeft--):s=!0,s)switch(c){case"north":o--;break;case"south":o++;break;case"east":r++;break;default:r--}}else 68==n.which||39==n.which?(i=!0,e.roomRot-=5,e.playerFacing=e.roomRot%360>0?e.roomRot%360:360+e.roomRot%360):65==n.which||37==n.which?(i=!0,e.roomRot+=5,e.playerFacing=e.roomRot%360>0?e.roomRot%360:360+e.roomRot%360):66==n.which&&e.bombsLeft&&!e.bombOn?e.bombOn=!0:66==n.which&&e.bombOn?e.bombOn=!1:82==n.which?e.rotOn=!e.rotOn:192==n.which&&(e.setActive=!e.setActive);i&&n.preventDefault(),87!=n.which&&38!=n.which&&83!=n.which&&40!=n.which||!s||e.moving||(e.playerCell=r+"-"+o,e.cells[e.cellNames.indexOf(e.playerCell)].pViz=!0,e.intTarg="object"==_typeof(e.cells[e.cellNames.indexOf(e.playerCell)].has)&&!e.cells[e.cellNames.indexOf(e.playerCell)].has.inv&&e.cells[e.cellNames.indexOf(e.playerCell)].has,e.intTarg&&(console.log("cell cons (probly mons):",e.intTarg),e.moveReady=!1,e.inCombat=!0,l.combatReady()),"object"==_typeof(e.cells[e.cellNames.indexOf(e.playerCell)].has)&&e.cells[e.cellNames.indexOf(e.playerCell)].has.inv?(e.currNpc=e.cells[e.cellNames.indexOf(e.playerCell)].has,e.merchy.prepNpc(),e.isNearMerch=e.cells[e.cellNames.indexOf(e.playerCell)].has.inv):e.currNpc=null,e.$digest(),e.moveAni())}else 73==n.which&&(console.log("key i was pressed"),e.invActive=!e.invActive,e.invActive?e.moveReady=!1:e.moveReady=!0,e.$digest())},e.moving=!1,e.moveAni=function(n){e.moving=!0,$("body").fadeOut(500,function(){$("body").fadeIn(500,function(){if(e.moving=!1,n&&0!==n){e.lvl++;var t={name:e.name,lvl:e.lvl,equip:e.playerItems,questDone:e.questList||[],inProf:e.doneQuest,maxHp:e.maxHp,currHp:e.currHp,maxEn:e.maxEn,currEn:e.currEn,isStunned:e.isStunned,currentLevel:{loc:"",data:[],names:[]}};console.log("new lvl!:",e.lvl),s.saveGame(t,!1,!0)}})})},e.turnSpeed=0,window.onmousemove=function(n){e.$digest();var t=(n.x||n.clientX)/$(window).width();if(Math.abs(t-.5)>.3){var r=t>.5?-1:1,o=(Math.abs(t-.5)-.3)/.2;e.turnSpeed=6*r*o/1.5}else e.turnSpeed=0},e.mouseTurnTimer=r(function(){e.roomRot+=e.turnSpeed,e.playerFacing=e.roomRot%360>0?e.roomRot%360:360+e.roomRot%360},50),e.bomb=function(n){var t=e.playerCell.split("-")[0],r=e.playerCell.split("-")[1],o="";switch(n){case"north":r--,o="south";break;case"east":t++,o="west";break;case"south":r++,o="north";break;default:t--,o="east"}var a=t+"-"+r;e.cells[e.cellNames.indexOf(a)][o]=!1,e.cells[e.cellNames.indexOf(e.playerCell)][n]=!1,e.bombOn=!1},e.rotOn=!0,e.vertRot=85,e.getWallStatus=function(n){try{var t=e.cells[e.cellNames.indexOf(e.playerCell)][n]?"./img/wall.jpg":"./img/door.jpg"}catch(r){}return t},e.isExit=function(){try{var n="exit"==e.cells[e.cellNames.indexOf(e.playerCell)].has?"./img/exit.png":"./img/ground.jpg"}catch(t){}return n},e.noMove=function(e){e.stopPropagation()},e.floorCursor=function(){return"exit"==e.cells[e.cellNames.indexOf(e.playerCell)].has?"pointer":"auto"},$("#uiloader").draggable({constrain:"body"}),e.inpPhone=function(){e.moveReady=!1,sandalchest.prompt("Enter a name (you get this by visiting the site on your phone)!",function(n){null!==n&&" "!=n&&socket.emit("chkName",{n:n}),e.moveReady=!0})},socket.on("chkNameRes",function(n){n.n&&(e.uName=n.n),console.log("Name:",n.n)}),e.travelOkay=!0,e.phoneMovTimer,socket.on("movOut",function(n){if(n.n==e.uName){var t=null,r=null;"l"==n.x?(t=new Event("keydown"),t.which=65,window.onkeydown(t)):"r"==n.x&&(t=new Event("keydown"),t.which=68,window.onkeydown(t)),"f"==n.y&&e.travelOkay?(r=new Event("keydown"),r.which=87,window.onkeydown(r),e.travelOkay=!1,e.phoneMovTimer=o(function(){e.travelOkay=!0},1e3)):"b"==n.y&&e.travelOkay&&(r=new Event("keydown"),r.which=83,window.onkeydown(r),e.travelOkay=!1,e.phoneMovTimer=o(function(){e.travelOkay=!0},1e3))}}),e.getUIInfo=function(e){var n;console.log("getUIInfo:",e),n=e.item&&e.item.length&&e.item.length>2?e.item[0].pre+" "+e.item[1].name+" "+e.item[2].post:e.name&&e.desc?e.name:e.item[0].name;var t;t=e.item&&e.item.length&&e.item.length>2?e.item[1].desc+"<br/>"+e.item[0].description+"<br/>"+e.item[2].description:e.name&&e.desc?e.desc:e.item[0].desc,sandalchest.dialog("<h3>"+n+"</h3>","<p>"+t+'</p><p id="moreInf" style="display:none;"></p>',{buttons:[{text:"Close",close:!0},{text:"More Info",close:!1,click:function(){return"none"==$("#moreInf").css("display")?s.moreInfo(e):s.lessInf(),!1}}]})},e.levelDown=function(){sandalchest.confirm("Ready to go to the next level?",function(n){n&&null!==n&&e.moveAni(1)})},e.saveGame=function(n){var t={name:e.name,lvl:e.lvl,equip:e.playerItems,questDone:e.questList||[],inProf:e.doneQuest,maxHp:e.maxHp,currHp:e.currHp,maxEn:e.maxEn,currEn:e.currEn,isStunned:e.isStunned,currentLevel:{loc:e.playerCell,data:e.cells,names:e.cellNames}};console.log("save data to ui fac:",t),s.saveGame(t,!1,n)},e.saveAndLogout=function(){var n={name:e.name,lvl:e.lvl,equip:e.playerItems,questDone:e.questList||[],inProf:e.doneQuest,maxHp:e.maxHp,currHp:e.currHp,maxEn:e.maxEn,currEn:e.currEn,isStunned:e.isStunned,currentLevel:{loc:e.playerCell,data:e.cells,names:e.cellNames}};s.saveGame(n,!0,!1)},e.logout=s.logout,e.reset=s.reset,e.trunc=function(e){return Math.floor(10*e)/10},e.isNearMerch=!1,e.equipItem=function(n,t){if(2==n.lootType)return void alert("JUNK REWARD");console.log("EL",n);var r=n.item&&n.item[1]&&"undefined"!=typeof n.item[1].slot?n.item[1].slot:-1;if(n.item&&n.item.length>2&&r!=-1);else{if(!(n.item&&n.item.length>2))return;r=5}var o=angular.copy(e.bodyBoxes[r]),a={lootType:"weap"==o.name?1:0,item:angular.copy(o.itFullInfo),num:1};e.bodyBoxes[r].itFullInfo=n.item,e.bodyBoxes[r].itName=e.bodyBoxes[r].itFullInfo[0].pre+" "+e.bodyBoxes[r].itFullInfo[1].name+" "+e.bodyBoxes[r].itFullInfo[2].post,console.log("LOCATOR",r,"NAME:",e.bodyBoxes[r].name,"FROM",e.bodyBoxes[r],"TO",e.playerItems[e.bodyBoxes[r].name],"OLD ITEM:",o);for(var i=0;i<e.playerItems[e.bodyBoxes[r].name].length;i++)e.playerItems[e.bodyBoxes[r].name][i]=e.bodyBoxes[r].itFullInfo[i].num;e.playerItems.inv.splice(t,1);"undefined"!=typeof a.item&&e.playerItems.inv.push(a),s.doPlayerInv(e.playerItems,e.bodyBoxes).then(function(n){e.bodyBoxes=n,e.currUIObjs=e.playerItems.inv})},e.contMenOn=!1,window.oncontextmenu=function(n){"Inventory"==e.currUIPan&&"currUIEl ng-binding ng-scope"==n.target.className&&(n.preventDefault(),n.stopPropagation(),e.contMenOn=s.getContMen(angular.element(n.target).scope(),n.x,n.y),e.$apply())},window.onclick=function(n){console.log(n.target,n.target.id,"contexMen"==n.target.id),n.button&&0!==n.button||"contexMen"==n.target.id||(e.contMenOn=!1)},e.trashItem=function(n,t){sandalchest.confirm("Are you sure you wish to destroy this "+(n.item.length>1?n.item[0].pre+" "+n.item[1].name+" "+n.item[2].post:n.item[0].name)+"?",function(r){console.log("RES",r,n.name),r&&null!==r&&(e.playerItems.inv.splice(t,1),s.doPlayerInv(e.playerItems,e.bodyBoxes).then(function(n){e.bodyBoxes=n,e.currUIObjs=e.playerItems.inv}))})}}]),app.controller("mob-con",["$scope","$http","$q","$interval","$swipe","$window","UIFac",function(e,n,t,r,o,a,i){e.currRotX=0,e.currRotY=0,e.rotX=null,e.rotY=null,e.uName="retrieving...",e.uiOpts=["Inventory","Skills","Bestiary","Quests","Menu"],e.prevUI="Quests",e.currUI="Menu",e.nextUI="Inventory",e.uiObjs=[],e.getUn=function(){var n=String.fromCharCode(65+Math.floor(25*Math.random())),t=String.fromCharCode(65+Math.floor(25*Math.random()));$.ajax({dataType:"jsonp",url:"https://simple.wiktionary.org/w/api.php?action=query&list=categorymembers&format=json&cmsort=sortkey&cmstartsortkeyprefix="+n+"&cmlimit=500&cmtitle=Category:Nouns",success:function(n){for(var r=" ";r.indexOf(" ")!=-1;)r=n.query.categorymembers[Math.floor(Math.random()*n.query.categorymembers.length)].title;console.log("final noun:",r),$.ajax({dataType:"jsonp",url:"https://simple.wiktionary.org/w/api.php?action=query&list=categorymembers&format=json&cmsort=sortkey&cmstartsortkeyprefix="+t+"&cmlimit=500&cmtitle=Category:Adjectives",success:function(n){for(var t=" ";t.indexOf(" ")!=-1;)t=n.query.categorymembers[Math.floor(Math.random()*n.query.categorymembers.length)].title;e.uName=t.toLowerCase()+" "+r.toLowerCase(),e.movObj.n=e.uName,socket.emit("movData",e.movObj),e.$digest()}})}})},e.getUn(),e.sendMove=r(function(){"retrieving..."!=e.uName&&e.isMoving&&socket.emit("movData",e.movObj)},75),e.isMoving=!1,e.movObj={x:e.rotX,y:e.rotY,n:null},a.addEventListener("deviceorientation",function(n){if("retrieving..."!=e.uName){var t=Math.floor(n.gamma/90*120),r=Math.floor(n.beta/90*120);e.isMoving=!1,t>50?(e.rotX="r",e.isMoving=!0):t<-50?(e.rotX="l",e.isMoving=!0):e.rotX=null,r<-35?(e.rotY="f",e.isMoving=!0):r>35?(e.rotY="b",e.isMoving=!0):e.rotY=null,e.movObj={x:e.rotX,y:e.rotY,n:e.uName}}}),e.ringSize=275,e.currRingRot=0,e.rngChTimer,e.rngChOkay=!0,e.ringChAni=function(n,t){if(!e.rngChOkay)return!1;if([].slice.call($(".RingUIEl")).length)$(".RingUIEl").animate({transform:"rotateY(0deg) translateZ("+e.ringSize+"px);"},{duration:500,complete:function(){e.currUI=e.uiOpts[n],console.log("switched from",e.uiOpts[t],"to",e.uiOpts[n]),n<t?(e.nextUI=e.uiOpts[t],t?e.prevUI=e.uiOpts[t-1]:e.prevUI=e.uiOpts[e.uiOpts.length-1]):(e.prevUI=e.uiOpts[t],n<e.uiOpts.length-2?e.nextUI=e.uiOpts[n+1]:e.nextUI=e.uiOpts[0]),console.log("NEW UI OBJECTS:",i.getRingObjs(n)),console.log("num ui objs"),e.currRingRot=0;var r=i.getRingObjs(n);console.log("DATA",r),e.uiObjs=r.objs,e.rotPer=r.rot}});else{e.currUI=e.uiOpts[n],console.log("switched from",e.uiOpts[t],"to",e.uiOpts[n]),n<t?(e.nextUI=e.uiOpts[t],t?e.prevUI=e.uiOpts[t-1]:e.prevUI=e.uiOpts[e.uiOpts.length-1]):(e.prevUI=e.uiOpts[t],n<e.uiOpts.length-2?e.nextUI=e.uiOpts[n+1]:e.nextUI=e.uiOpts[0]),console.log("NEW UI OBJECTS:",i.getRingObjs(n)),console.log("num ui objs"),e.currRingRot=0;var r=i.getRingObjs(n);console.log("DATA",r),e.uiObjs=r.objs,e.rotPer=r.rot}e.rngChOkay=!1,e.rngChTimer=setTimeout(function(){e.rngChOkay=!0},1e3)},e.uiObjs=i.getRingObjs(0),e.chMenRng=function(n){var t=e.uiOpts.indexOf(e.currUI),r=t;n&&0!==n?t<e.uiOpts.length-1?t++:t=0:t&&0!==t?t--:t=e.uiOpts.length-1,console.log("changing menu ring:",n,t,r),e.ringChAni(t,r)},e.oldX,e.oldY,e.noScroll=function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1},e.parseTouch=function(n){if(e.noScroll(n),!e.oldX||!e.oldY)return e.oldX=n.x,e.oldY=n.y,!1;var t=n.x-e.oldX,r=n.y-e.oldY;if(e.oldX=n.x,e.oldY=n.y,Math.abs(t)>Math.abs(r))e.currRingRot=i.PlatinumSpinningRings(e.currRingRot,t);else{if(!(Math.abs(r)>10))return!1;e.chMenRng(r>0?0:1)}},e.chMenRng(1),e.chMenRng(1),o.bind($("body#mob"),{move:e.parseTouch})}]),app.factory("combatFac",["$http",function(e){var n=["Physical","Fire","Ice","Poison","Dark","Holy"];return{getDmgType:function(e){return n[parseInt(e)]},combatReady:function(){$("#combat-box #enemy .health-bar .stat-bar-stat").css("width","100%"),$("#combat-box #player .health-bar .stat-bar-stat").css("width","100%"),$("#combat-box #player .energy-bar .stat-bar-stat").css("width","100%")},getSkillInf:function(e,n){sandalchest.dialog(e[n].name,e[n].desc,{buttons:[{text:"Okay",close:!0}]})},updateBars:function(e,n,t,r,o,a){e=parseInt(e),n=parseInt(n),t=parseInt(t),r=parseInt(r),o=parseInt(o),a=parseInt(a);var i=parseInt(100*n/e),l=parseInt(100*r/t),s=parseInt(100*a/o);console.log(s,i,l),$("#combat-box #enemy .health-bar .stat-bar-stat").css("width",s+"%"),$("#combat-box #player .health-bar .stat-bar-stat").css("width",i+"%"),$("#combat-box #player .energy-bar .stat-bar-stat").css("width",l+"%")},getItems:function(){return e.get("/item/allItems").then(function(e){return e})},rollLoot:function(n){return e.get("/item/byLvl/"+n.lvl).then(function(e){return e.data})}}}]),app.controller("comb-con",["$scope","$http","$q","$timeout","$window","combatFac",function(e,t,r,o,a,i){e.comb={},e.comb.skills,e.comb.playersTurn=!1,e.comb.itemStats,e.comb.attackEffects=[],e.inCombat=!0,e.comb.lastDefeated=null,e.comb.prepComb=function(){e.comb.lastDefeated=e.intTarg.name,e.comb.battleStatus={status:!1,title:"NONE",txt:"NONE",btn:"YOU SHOULD NOT BE HERE"},e.intTarg.currHp=e.intTarg.hp,$(".pre-battle").hide(250),i.getItems().then(function(n){e.comb.itemStats=n.data,e.currPRegens=[],e.currPDegens=[],e.currMRegens=[],e.currMDegens=[],e.comb.monsTurn()})},e.comb.skillCh=function(n){n?e.currSkillNum<e.comb.skills.length-1?e.currSkillNum++:e.currSkillNum=0:e.currSkillNum>0?e.currSkillNum--:e.currSkillNum=e.comb.skills.length-1},e.comb.getAllSkills=function(){t.get("/item/Skills").then(function(n){console.log("ALL SKILLS",n.data),e.comb.skills=n.data})},e.currPRegens=[],e.currPDegens=[],e.currMRegens=[],e.currMDegens=[],e.monsStunned=!1,e.pStunned=!1,e.comb.getAllSkills(),e.comb.showSkillInf=function(){i.getSkillInf(e.comb.skills,e.currSkillNum)},e.comb.attemptFlee=function(){},e.comb.wait=function(){e.comb.updateDoTs(),e.currHp<=0?e.comb.dieP():(e.comb.playersTurn=!1,e.comb.monsTurn())},e.comb.attack=function(){e.comb.attackEffects=[];var n=parseInt(e.comb.calcDmg(1));e.intTarg.currHp-=n,i.updateBars(e.maxHp,e.currHp,e.maxEn,e.currEn,e.$parent.intTarg.hp,e.$parent.intTarg.currHp),e.comb.updateDoTs();var t="You attack for "+n+" "+i.getDmgType(e.comb.skills[e.currSkillNum].type)+" damage, using "+e.comb.skills[e.currSkillNum].name+"!";if(e.comb.attackEffects.length){var r="nova"==e.comb.attackEffects;r&&e.comb.attackEffects.shift();for(var o=" Your attack is a ",a=0;a<e.comb.attackEffects.length-1;a++)o+=e.comb.attackEffects[a]+", ";o+=e.comb.attackEffects.length>1?"and "+e.comb.attackEffects[e.comb.attackEffects.length-1]+" one.":e.comb.attackEffects[e.comb.attackEffects.length-1]+" one.",t+=o}sandalchest.alert(t,function(n){e.intTarg.currHp<=0?e.comb.dieM():(e.comb.playersTurn=!1,e.comb.monsTurn())})},e.comb.DoT=function(e,n,t){this.dur="undefined"!=typeof t?t:5,this.name=e,this.amt=n},e.comb.checkDoTDup=function(e,n){for(var t=0;t<e.length;t++)if(e[t].name==n)return!1;return!0},e.resetDoTDur=function(n,t,r){for(var o=0;o<e[n].length;o++)if(e[n][o].name==t){e[n][o].dur="undefined"!=typeof r?r:5;break}},e.comb.calcDmg=function(n){var t=e.comb.itemStats[1],r=e.comb.itemStats[0],o=e.comb.itemStats[2],a=e.comb.itemStats[3];console.log("WEAP IDS",e.$parent.playerItems.weap,"WEAPS",t,"ARMOR",r,"AFFIXES",o,"JUNK",a);var l=e.$parent.playerItems.weap[1]!=-1&&[o[e.$parent.playerItems.weap[0]],t[e.$parent.playerItems.weap[1]],o[e.$parent.playerItems.weap[2]]];console.log(l[0].pre+" "+l[1].name+" "+l[2].post,l);var s,c,m,u=0,p=0,g=!1;if(m=e.$parent.intTarg.lvl/e.lvl>2?2:e.$parent.intTarg.lvl/e.lvl<.5?.5:e.$parent.intTarg.lvl/e.lvl,n){if(!e.pStunned&&e.comb.skills[e.currSkillNum].energy<=e.currEn){s=e.comb.skills[e.currSkillNum].type,l[0].dmgType!=-1&&(s=l[0].dmgType),l[2].dmgType!=-1&&(s=l[2].dmgType);var h=l?Math.floor(Math.random()*(l[1].max-l[1].min))+l[1].min:0;(Math.random()<l[0].brut||Math.random()<l[2].brut)&&(h*=1.7,e.comb.attackEffects.push("brutal"));var d=e.comb.skills[e.currSkillNum].burst;if(console.log("ATTACKED USING A SKILL"),console.log("SKILL WAS:",e.comb.skills[e.currSkillNum]),e.comb.skills[e.currSkillNum].degen){var f=Math.random()<l[0].crue||Math.random()<l[2].crue?10:5;f>5&&e.comb.attackEffects.push("cruel"),e.comb.checkDoTDup(e.currMDegens,e.$parent.intTarg.name+"-"+e.comb.skills[e.currSkillNum].name+"-degen")?e.currMDegens.push(new e.comb.DoT(e.$parent.intTarg.name+"-"+e.comb.skills[e.currSkillNum].name+"-degen",e.comb.skills[e.currSkillNum].degen,f)):e.resetDoTDur("currMDegens",e.$parent.intTarg.name+"-"+e.comb.skills[e.currSkillNum].name+"-degen",f)}if(e.comb.skills[e.currSkillNum].regen){var y=Math.random()<l[0].rejuv||Math.random()<l[2].rejuv?10:5;y>5&&e.comb.attackEffects.push("rejuvenating"),e.comb.checkDoTDup(e.currPRegens,"player-"+e.comb.skills[e.currSkillNum].name+"-regen")?e.currPRegens.push(new e.comb.DoT("player-"+e.comb.skills[e.currSkillNum].name+"-regen",e.comb.skills[e.currSkillNum].regen,y)):e.resetDoTDur("currPRegens","player-"+e.comb.skills[e.currSkillNum].name+"-regen",y)}if(e.comb.skills[e.currSkillNum].heal){var b=Math.random()<l[0].bene||Math.random()<l[2].bene?2:1;y>5&&e.comb.attackEffects.push("benedictive"),e.currHp+=e.comb.skills[e.currSkillNum].heal*b,e.currHp>e.maxHp&&(e.currHp=e.maxHp)}(e.comb.skills[e.currSkillNum].stuns||Math.random()<l[0].stunCh||Math.random()<l[2].stunCh)&&(e.monsStunned=!0,e.comb.attackEffects.push("stunning"));var v=Math.random()<l[0].novaChance||Math.random()<l[2].novaChance?.5*h:0;if(v&&e.comb.attackEffects.unshift("nova"),e.intTarg.res.indexOf(l[0].novaType)==-1&&e.intTarg.res.indexOf(l[1].novaType)==-1||(v=Math.floor(v/3)),(Math.random()<l[0].conf||Math.random()<l[2].conf)&&(e.monsConf=!0,e.comb.attackEffects.push("confusing")),l[0].vamp>0||l[2].vamp>0){e.comb.attackEffects.push("life-stealing");var k=.1*Math.random()+.05;e.currHp+=(h+d)*k,e.currHp>e.maxHp&&(e.currHp=e.maxHp)}return e.currEn-=e.comb.skills[e.currSkillNum].energy,d+h+v}e.comb.skills[e.currSkillNum].energy>e.currEn?sandalChest.alert("You don't have enough energy to use "+e.comb.skills[e.currSkillNum].name+"."):sandalChest.alert("You've been stunned! You can't attack this turn.")}else if(e.monsStunned)e.monsStunned=!1;else{s=e.$parent.intTarg.type,u=m*(Math.ceil(Math.random()*(e.$parent.intTarg.max-e.$parent.intTarg.min))+e.$parent.intTarg.min);var I={head:{freq:1},chest:{freq:5},hands:{freq:3},legs:{freq:2},feet:{freq:1}},w=e.comb.freqGen(I),x=w[Math.floor(Math.random()*w.length)],T=0;e.playerItems[x]&&e.playerItems[x][1]&&e.playerItems[x][1]>-1&&(T=r[e.playerItems[x][1]].def);var O=0;if(l[1].def&&(O+=l[1].def),console.log("Now running inv item defense",e.playerItems.inv),e.playerItems.inv&&e.playerItems.inv.length){console.log("----Checking defense items:----");for(var M=0;M<e.playerItems.inv.length;M++)0==e.playerItems.inv[M].lootType&&(console.log("CHECKING DEFENSE ON ITEM:",e.playerItems.inv[M]),O+=e.playerItems.inv[M].item[1].def||0),e.playerItems.inv[M].item&&e.playerItems.inv[M].item[1]&&e.playerItems.inv[M].item[1].res&&e.playerItems.inv[M].item[1].res.indexOf(s)!=-1&&(g=!0)}p=T+O}return c=u/(3*Math.log10(p+1)||1),g?c/=3:(1!=l[0].defChanges[i.getDmgType(s)]&&1!=l[2].defChanges[i.getDmgType(s)]||(c/=3),l[0].defChanges[i.getDmgType(s)]!=-1&&l[2].defChanges[i.getDmgType(s)]!=-1||(c=1.5*c)),c},e.comb.freqGen=function(e){for(var n=Object.keys(e),t=[],r=0;r<n.length;r++)for(var o=0;o<e[n[r]].freq;o++)t+=n[r];return t},e.comb.acceptStatus=function(){var n="Victory!"==e.comb.battleStatus.title;$(".pre-battle").show(10),e.comb.battleStatus={status:!1,title:" ",txt:" ",url:"./img/paper.jpg"},n?(i.rollLoot(e.intTarg).then(function(n){console.log("FROM ROLL LOOT",n);var t="",r={};"junk"==n.type?(t=n.loot.name,r.lootType=2,r.num=n.num,r.item=n.loot,e.playerItems.inv.push(r)):(r.lootType=n.type,r.num=n.num,r.item=[n.loot.pre,n.loot.base,n.loot.post],t=n.loot.pre.pre+" "+n.loot.base.name+" "+n.loot.post.post,e.playerItems.inv.push(r)),sandalchest.alert("After killing the "+e.comb.lastDefeated+", you recieve "+t+"!")}),angular.element("body").scope().cells[angular.element("body").scope().cellNames.indexOf(angular.element("body").scope().playerCell)].has=""):(angular.element("body").scope().playerCell="0-0",angular.element("body").scope().intTarg.currHp=angular.element("body").scope().hp,e.$parent.intTarg.currHp=e.$parent.intTarg.hp),e.inCombat=!1,angular.element("body").scope().inCombat=!1,angular.element("body").scope().intTarg=!1,angular.element("body").scope().moveReady=!0,angular.element("body").scope().currHp=angular.element("body").scope().maxHp,angular.element("body").scope().currEn=angular.element("body").scope().maxEn,e.currHp=e.maxHp,e.currEn=e.maxEn,i.updateBars(e.maxHp,e.currHp,e.maxEn,e.currEn,e.$parent.intTarg.hp,e.$parent.intTarg.currHp),angular.element("body").scope().$apply()},e.comb.battleEndMsgs={win:["Onward!","To victory!","Forward"],lose:["Retry!","I'll be back!","Another time then..."]},e.comb.dieP=function(){e.comb.battleStatus={status:!0,title:"Defeat!",txt:"You've been defeated!",url:"./img/assets/Defeat.jpg",btn:e.comb.battleEndMsgs.lose[Math.floor(Math.random()*e.comb.battleEndMsgs.lose.length)]}},e.comb.dieM=function(){e.comb.battleStatus={status:!0,title:"Victory!",txt:"You are victorious! The "+e.intTarg.name+" lies defeated at your feet.",url:"./img/assets/Victory.jpg",btn:e.comb.battleEndMsgs.win[Math.floor(Math.random()*e.comb.battleEndMsgs.win.length)]},console.log(e.comb.battleStatus)},e.comb.updateDoTs=function(){for(n=0;n<e.currPRegens;n++)e.currHp+=e.currPRegens[n].amt,e.currPRegens[n].dur--,e.currPRegens[n].dur||e.currPRegens.splice(n,1);for(e.currHp>e.maxHp&&(e.currHp=e.maxHp),n=0;n<e.currPDegens;n++)e.currHp-=e.currPDegens[n].amt,e.currPDegens[n].dur--,e.currPDegens[n].dur||e.currPDegens.splice(n,1);for(n=0;n<e.currMRegens;n++)e.intTarg.currHp+=e.currMRegens[n].amt,e.currMRegens[n].dur--,e.currMRegens[n].dur||e.currMRegens.splice(n,1);for(e.intTarg.currHp>e.intTarg.hp&&(e.intTarg.currHp=e.intTarg.hp),n=0;n<e.currMDegens;n++)e.intTarg.currHp+=e.currMDegens[n].amt,e.currMDegens[n].dur--,e.currMDegens[n].dur||e.currMDegens.splice(n,1)},e.comb.monsTurn=function(){if(console.log("monster taking turn!"),e.monsStunned)sandalchest.alert(e.$parent.intTarg.name+" is stunned this turn!",function(){e.comb.playersTurn=!0});else{var n=parseInt(e.comb.calcDmg()),t=Math.random()<.5&&e.monsConf;t?(e.monsConf=!1,e.intTarg.currHp-=n,i.updateBars(e.maxHp,e.currHp,e.maxEn,e.currEn,e.$parent.intTarg.hp,e.$parent.intTarg.currHp),sandalchest.alert(e.$parent.intTarg.name+" is confused, and attacks itself for "+n+" "+i.getDmgType(e.$parent.intTarg.type)+"!",function(){e.comb.updateDoTs(),e.intTarg.currHp<=0?e.comb.dieM():(e.comb.playersTurn=!0,e.currEn+=2,e.currEn>e.maxEn&&(e.currEn=e.maxEn))})):e.intTarg.currHp/e.intTarg.hp>.5&&Math.random<e.intTarg.healCh?sandalchest.alert("The "+e.intTarg.name+" heals!",function(){var n=e.intTarg.hp*(.07+Math.random()/10);e.intTarg.currHp+=n,e.intTarg.currHp>e.intTarg.hp&&(e.intTarg.currHp=e.currHp),e.comb.playersTurn=!0}):e.intTarg.currHp/e.intTarg.hp>.5&&-3.6*(e.intTarg.currHp/e.intTarg.hp)+3>Math.random()?sandalchest.alert("The "+e.intTarg.name+" heals!",function(){var n=e.intTarg.hp*(.07+Math.random()/10);e.intTarg.currHp+=n,e.intTarg.currHp>e.intTarg.hp&&(e.intTarg.currHp=e.currHp),e.comb.playersTurn=!0}):(Math.random()<e.$parent.intTarg.stunCh&&(e.pStunned=!0),e.currHp-=n,i.updateBars(e.maxHp,e.currHp,e.maxEn,e.currEn,e.$parent.intTarg.hp,e.$parent.intTarg.currHp),sandalchest.alert(e.$parent.intTarg.name+" attacks for "+n+" "+i.getDmgType(e.$parent.intTarg.type)+"!",function(){e.comb.updateDoTs(),console.log("triggered cb for mons attack"),e.currHp<=0?e.comb.dieP():(e.comb.playersTurn=!0,e.currEn+=2,e.currEn>e.maxEn&&(e.currEn=e.maxEn))}))}}}]),app.factory("econFac",["$http","$q",function(e,n){return{merchInv:function(n,t){return e.get("/item/allItems/").then(function(e){var r=[];console.log("GETTING ITEM DATA:invArr",n);for(var o=0;o<n.length;o++)0==n[o].lootType?r.push([e.data[2][n[o].item[0]],e.data[0][n[o].item[1]],e.data[2][n[o].item[2]]]):r.push([e.data[2][n[o].item[0]],e.data[1][n[o].item[1]],e.data[2][n[o].item[2]]]);return{inv:r,id:t}})},getNpc:function(n){
return e.get("/other/oneNpc/"+n).then(function(e){return{data:e.data.data,id:e.data.i}})},getQuests:function(n,t,r){var o=t.split("-");return e.get("/quest/npcQ/"+o[0]+"/"+o[1]+"/"+r+"/"+n).then(function(e){return e.data})}}}]),app.factory("mazeFac",["$http",function(e){var n=function(e,n){this.id=e,this.x=e.split("-")[0],this.y=e.split("-")[1],this.east=!0,this.west=!0,this.north=!0,this.south=!0,this.visited=!1,this.pViz=!1,this.has=n},t=[],r=0,o=[],a="",i=[],l=["loot","mons","npcs","jewl"," ","exit"," "," ","mons","mons"],s=function(){for(var e=!1;!e;){if(i.pop(),!i.length)return!1;a=i[i.length-1];for(var n,r=["n","e","s","w"],l=t.indexOf(a);!e&&r.length;)n=Math.floor(Math.random()*r.length),e=o[l].checkCell(r[n]),"e"!=e&&"v"!=e||(e=!1,r.splice(n,1))}return e};return n.prototype.dig=function(e,n){switch(e){case"n":this.north=!1,n.south=!1;break;case"e":this.east=!1,n.west=!1;break;case"s":this.south=!1,n.north=!1;break;default:this.west=!1,n.east=!1}},n.prototype.checkCell=function(e){var n=this.id.split("-"),r=parseInt(n[0]),a=parseInt(n[1]);switch(e){case"n":a--;break;case"e":r++;break;case"s":a++;break;default:r--}var i=r+"-"+a,l=t.indexOf(i);return l==-1?"e":o[l].visited?"v":i},{popCell:function(n,t){return e.get("/item/beastie/"+n+"/"+t).then(function(e){return e.data})},makeMaze:function(e,c){o=[],t=[],i=[],r=0,didEx=!1;for(var m=0;m<e;m++)for(var u=0;u<c;u++){for(var p=l[Math.floor(Math.random()*l.length)];(0===m||0===u)&&"exit"==p;)p=l[Math.floor(Math.random()*l.length)];"exit"==p&&(didEx=!0,l.splice(5,1)),o.push(new n(m+"-"+u,p)),t.push(m+"-"+u)}for(didEx||(o[Math.floor(Math.random()*o.length)].has="exit"),a="0-0";r<t.length;){i.push(a);for(var g,h=["n","e","s","w"],d=t.indexOf(a),f=!1;!f&&h.length;)g=Math.floor(Math.random()*h.length),f=o[d].checkCell(h[g]),"e"!=f&&"v"!=f||(f=!1,h.splice(g,1));if(o[d].visited=!0,f||(f=s()),!f)break;a=f;var y=t.indexOf(a);o[d].dig(h[g],o[y]),r++}return{cells:o,names:t,path:i}}}}]),app.controller("merch-cont",["$scope","$http","$q","$timeout","$window","econFac","UIFac",function(e,n,t,r,o,a,i){console.log("THING RUNNING"),e.merchy.prepNpc=function(){if(e.merchy.buy=!0,e.merchy.merch=e.currNpc,e.merchy.merch.sez=e.merchy.merch.gossip[Math.floor(Math.random()*e.merchy.merch.gossip.length)],!e.merchy.merch.alreadyInfoed){a.merchInv(e.merchy.merch.inv).then(function(n){console.log("THIS NPC HAS:",n);for(var t=0;t<e.merchy.merch.inv.length;t++)e.merchy.merch.inv[t].item=n.inv[t];e.merchy.merch.alreadyInfoed=!0,e.$apply()})}},e.merchy.itemForPlayer=null,e.merchy.exchange=function(n,t,r){e.moveReady=!1,angular.element("body").scope().moveReady=!1;var o=n.item[0].pre+" "+n.item[1].name+"s "+n.item[2].post,a=Math.floor(n.item[1].cost*(10+n.item[0].cost+n.item[2].cost))/10;console.log("ITEM DATA TO EXCHANGE",n,"and dir:",t),sandalchest.dialog((t?"Sell":"Buy")+" Items","How many "+o+" do you want to "+(t?"sell":"buy")+"?<hr/><input type=number value=1 min=1 max="+n.num+" id='numExch'>",{buttons:[{text:(t?"Sell":"Buy")+" Items",close:!0,click:function(){var l=parseInt($("#numExch").val());if(t&&"false"!=t)l<n.num?e.playerItems.inv[r].num-=l:e.playerItems.inv.splice(r,1),e.playerItems.gold+=a*l*.9;else if(l*a<e.playerItems.gold){l<n.num?e.merchy.merch.inv[r].num-=l:e.merchy.merch.inv.splice(r,1);for(var s=-1,c=0;c<e.playerItems.inv.length;c++){var m=e.playerItems.inv[c].item[0].pre+" "+e.playerItems.inv[c].item[1].name+"s "+e.playerItems.inv[c].item[2].post;o==m&&(s=c)}if(s!=-1)e.playerItems.inv[s].num+=l;else{e.merchy.itemForPlayer=angular.copy(n),console.log("ITEM FOR PLAYER",e.merchy.itemForPlayer),e.merchy.itemForPlayer.num=l,e.playerItems.inv.push(e.merchy.itemForPlayer)}e.playerItems.gold-=a*l}else sandalchest.alert("You don't have enough money to afford "+l+" "+o+"s!");i.doPlayerInv(e.playerItems,e.bodyBoxes).then(function(n){e.bodyBoxes=n,e.currUIObjs=e.playerItems.inv}),angular.element("body").scope().moveReady=!0,e.moveReady=!0}},{text:"Cancel",close:!0,click:function(){angular.element("body").scope().moveReady=!0,e.moveReady=!0}}]})}}]),app.factory("socketFac",["$rootScope",function(e){var n=io.connect();return{on:function(t,r){n.on(t,function(){var t=arguments;e.$apply(function(){r.apply(n,t)})})},emit:function(t,r,o){n.emit(t,r,function(){var t=arguments;e.$apply(function(){o&&o.apply(n,t)})})}}}]),app.factory("UIFac",["$http","$q","$location","$window","combatFac",function(e,n,t,r,o){return{getUIObj:function(n,t){var r=e.get("/item/"+n).success(function(e){return e});return r},getUIBg:function(e){var n={Inventory:"../img/UI/inv.jpg",Skills:"",Bestiary:"",Quests:""};return n[e]},moreInfo:function(n){var t=["Physical","Fire","Ice","Poison","Dark","Holy"],r='<ul class="moreInfList">';if(console.log(n,!!n.item,n.item),n.item&&(n.item[1].slot||0==n.item[1].slot)){var a;switch(n.item[1].slot){case 0:a="head";break;case 1:a="torso";break;case 2:a="pants";break;case 3:a="hands";break;case 4:a="feet";break;default:a="accessory"}r+="<li>Type:"+a+"</li>",r+="<li>Defense:"+n.item[1].def||"None</li>",r+="<li>Cost:"+n.item[1].cost+" coins</li>",r+="<li>Level:"+n.item[1].itemLvl+"</li>",r+="<li>Resistance:";for(var i=[],l=[],s=0;s<n.item[1].res.length;s++)i.indexOf(t[n.item[1].res[s]])==-1&&i.push(t[n.item[1].res[s]]);for(var c in n.item[0].defChanges)1==n.item[0].defChanges[c]&&i.indexOf(n.item[0].defChanges[c])==-1?i.push(n.item[0].defChanges[c]):n.item[0].defChanges[c]==-1&&vuln.indexOf(n.item[0].defChanges[c])==-1&&vuln.push(n.item[0].defChanges[c]);for(var c in n.item[2].defChanges)1==n.item[2].defChanges[c]&&i.indexOf(n.item[2].defChanges[c])==-1?i.push(n.item[2].defChanges[c]):n.item[2].defChanges[c]==-1&&vuln.indexOf(n.item[2].defChanges[c])==-1&&vuln.push(n.item[2].defChanges[c]);r+=(i.length?i.join(", "):"none")+"</li>",r+="<li>Vulnerabilities:"+(l.length?l.join(", "):"none")+"</li>"}else if(n.giver||0===n.giver)e.get("/item/getGiver/"+n.giver).then(function(e){console.log("results from quest-giver search",e.data[0]),r+="<li>Level:"+n.lvl+"</li>",r+="<li>Given by:"+e.data[0].Name+"</li>",r+="</ul>",$("#moreInf").html(r),$("#moreInf").show(200),$("div.modal-footer > button.btn.btn-info").html("Less info")});else if(n.energy||0===n.energy)r+="<li>Damage Type:"+o.getDmgType(n.type)+"</li>",r+="<li>Energy:"+n.energy+"</li>",r+=n.heal?"<li>Heal (burst):"+n.heal+" hp</li>":"",r+=n.regen?"<li>Heal (regeneration):"+n.regen+" hp/turn</li>":"",r+=n.burst?"<li>Damage:"+n.burst+" hp</li>":"",r+=n.degen?"<li>Degeneration:"+n.degen+" hp/turn</li>":"",r+=n.stuns?"<li>Stuns</li>":"";else if(n.maxHp)r+="What are you doing? You broke the game!";else if(n.item&&!n.item[1].slot)r+=n.item[1].max?"<li>Damage:"+n.item[1].min+"-"+n.item[1].max+" hp</li>":"",r+=n.item[1].def?"<li>Defense:"+n.item[1].def+"</li>":"",r+="<li>Level:"+n.item[1].itemLvl+"</li>",r+="<li>Cost:"+n.item[1].cost+" coins</li>";else{var m=!0;if(r+="<li>Level:"+n.lvl+"</li>",r+="<li>Hp:"+n.hp+" hp</li>",r+="<li>Dmg:"+n.min+"-"+n.max+" hp</li>",r+="<li>Damage Type:"+o.getDmgType(n.type)+"</li>",r+="<li>Resistance:",n.res&&n.res.length){r+="<ul>";for(var s=0;s<n.res.length;s++)r+="<li> "+o.getDmgType(n.res[s])+" </li>";r+="</ul>"}else r+="<span> none </span></li>"}n.giver||0==n.giver||(r+="</ul>",$("#moreInf").html(r),m&&$("#moreInf").css({background:"linear-gradient(rgba(241,241,212,.4),rgba(241,241,212,.4)),url("+n.imgUrl+")","background-size":"contain","background-repeat":"no-repeat","background-position":"right"}),$("#moreInf").show(200),$("div.modal-footer > button.btn.btn-info").html("Less info"))},lessInf:function(){$("#moreInf").hide(200),$("div.modal-footer > button.btn.btn-info").html("More info")},saveGame:function(n,t,o){for(var a=0;a<n.equip.inv.length;a++){if(console.log("ITEM:",n.equip.inv[a]),n.equip.inv[a].item instanceof Array||"object"!=_typeof(n.equip.inv[a].item))for(var i=0;i<n.equip.inv[a].item.length;i++)n.equip.inv[a].item[i]=n.equip.inv[a].item[i].num;else n.equip.inv[a].item=[n.equip.inv[a].item.num];console.log("Inventory reducified!:",JSON.stringify(n.equip.inv))}e.post("/user/save",n).then(function(n){t&&n?e.get("/user/logout").then(function(e){window.location.href="./login"}):o&&n?r.location.reload():sandalchest.alert("Saved!","Your game has been saved!")})},logout:function(n){sandalchest.confirm("Logout","<span id='resetWarn'>WARNING:</span> You will lose all progress since your last save! Are you sure you wanna stop playing and log out?",function(n){n&&null!==n&&e.get("/user/logout").then(function(e){window.location.href="./login"})})},reset:function(){var n=Math.floor(50*Math.random()),t=Math.floor(50*Math.random());sandalchest.dialog("Reset Account","<div id='resetWarn'>WARNING:</div> Resetting your account is a <i>permanent</i> move. <br/>If you still wish to reset your game account, enter your username and password below, and solve the math question below and click the appropriate button. Be aware that this decision <i>cannot</i> be reversed!<hr/>Username:<input type='text' id='rmun'><br/>Password:<input type='password' id='rmpw'><hr/>Math Check:<br/>"+n+" + "+t+" = <input type='number' id='mathChk'> ",{buttons:[{text:"YES, reset.",close:!1,click:function(){return parseInt($("#mathChk").val())==n+t&&(credObj={name:$("#rmun").val(),pass:$("#rmpw").val()},void e.post("/user/reset",credObj).then(function(e){return!!e&&(window.location.replace("./login"),!0)}))}},{text:"NO, don't.",close:!0}]})},resetLevel:function(){sandalchest.confirm("Are you sure you wanna reset this level?",function(n){n&&e.get("/resetLevel").then(function(e){r.location.reload()})})},getRingObjs:function(e){var n;switch(e){case 0:n=[{name:"head",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"chest",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"hands",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"legs",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"feet",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"ring",imgUrl:"",fn:function(){console.log("clicked this!")}}];break;case 1:n=[{name:"Change Skill",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Skill Info",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Attack",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Retreat",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Wait",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Player Status",imgUrl:"",fn:function(){console.log("clicked this!")}}];break;case 2:n=[{name:"Current Creature Info",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"All Creatures Info",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Search Creatures",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Vanquished Creatures",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Quest Creatures",imgUrl:"",fn:function(){console.log("clicked this!")}}];break;case 3:n=[{name:"Current Side Quests",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Legendary Quests",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Old Quests",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Main Quests",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Quest Stats",imgUrl:"",fn:function(){console.log("clicked this!")}}];break;default:n=[{name:"Save",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Save and Logout",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Logout without saving",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Reset Account",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"Stats",imgUrl:"",fn:function(){console.log("clicked this!")}},{name:"About",imgUrl:"",fn:function(){console.log("clicked this!")}}]}var t={objs:n,rot:360/n.length};return console.log("ring data",t),t},PlatinumSpinningRings:function(e,n){return e+n},doPlayerInv:function(n,t){return e.get("/item/allItems").then(function(e){for(var r in n)if("gold"!=r&&"inv"!=r){for(var o=-1,a=0;a<t.length;a++)if(t[a].name==r){o=a;break}n[r].indexOf(-1)==-1?(console.log("item isnt undefined!",n[r]),t[o].itName=e.data[2][n[r][0]].pre+" "+("weap"==r?e.data[1][n[r][1]].name:e.data[0][n[r][1]].name)+" "+e.data[2][n[r][2]].post,t[o].itFullInfo=[e.data[2][n[r][0]],"weap"==r?e.data[1][n[r][1]]:e.data[0][n[r][1]],e.data[2][n[r][2]]]):t[o].itName="none"}return t})},getContMen:function(e,n,t){return{x:n,y:t,el:e.UIEl,num:e.$index}}}}]),app.factory("userFact",["$http",function(e){return{checkPwdStr:function(e){console.log("password:",e);var n=new RegExp("[A-Z]","g"),t=new RegExp("[a-z]","g"),r=new RegExp("[0-9]","g"),o=new RegExp("\\W","g"),a=0;e.search(n)!=-1&&a++,e.search(t)!=-1&&a++,e.search(r)!=-1&&a++,e.search(o)!=-1&&a++;var i=e.length;return i>16?a+=6:i>11?a+=4:i>6&&(a+=2),a},checkPwdMatch:function(e,n){return e==n},checkName:function(n){return console.log("NAME TO BACKEND",n),e.get("/user/nameOkay/"+n).then(function(e){return console.log("NAME RESPONSE:",e.data),"okay"!=e.data})},login:function(n){return console.log("credentials in factory",n),e.post("/user/login",n).then(function(e){return console.log("response from backend:",e),"yes"==e.data})},checkLogin:function(){return e.get("/user/chkLog").then(function(e){return console.log("CHECKLOG RESULTS",e),e.data})}}}]);